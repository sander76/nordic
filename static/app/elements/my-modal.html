<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/marked-element/marked-element.html">
<dom-module id="my-modal">
    <style>
        iron-icon.ok {
            color: green !important;
        }

        iron-icon.cross {
            color: red !important;
        }

        .markdown-html {
            margin: 20px;
        }

        paper-dialog {
            font-size: inherit;
        }
    </style>
    <template>
        <paper-dialog id="modal" modal on-iron-overlay-closed="handleClose">
            <!-- <iron-a11y-keys id="modalconfirm" target='[[target]]' keys="[[modal_yes.keys]]" on-keys-pressed="closeModal">
            </iron-a11y-keys>
            <iron-a11y-keys id="modaldismiss" target='[[target]]' keys="[[modal_no.keys]]" on-keys-pressed="closeModalDismiss"></iron-a11y-keys> -->
            <img src$="[[modaldata.img]]" />
            <marked-element markdown=[[modaldata.text.content]]>
              <div class="markdown-html"></div>
            </marked-element>
            <!-- <p>[[modaldata.text.content]]</p> -->
            <div class="buttons">
                <paper-button noink dialog-dismiss>
                    <iron-icon class="cross" icon="icomoon:cross"></iron-icon>[[modaldata.no_text.content]]</paper-button>
                <paper-button noink dialog-confirm>
                    <iron-icon class="ok" icon="icomoon:checkmark"></iron-icon>[[modaldata.yes_text.content]]</paper-button>
            </div>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'my-modal',
            properties: {
                modaldata: {
                    type: Object,
                    value: {}
                } //,
                // modal_yes: {
                //     type: Object,
                //     value: {
                //         "keys": "Enter"
                //     }
                // },
                // modal_no: {
                //     type: Object,
                //     value: {
                //         "keys": "x"
                //     }
                // }
            },
            ready: function() {
                this.keys = {
                    Enter: {
                        func: "modal_close",
                        handle: this.closeModal
                    },
                    x: {
                        func: "modal_dismiss",
                        handle: this.closeModalDismiss
                    }
                };
            },
            openmodal: function() {
                document.body.addEventListener("keydown", this, false);
                this.$.modal.open();

            },


            handleClose: function(e) {
                document.body.removeEventListener("keydown", this, false);
                if (e.detail.confirmed) {
                    this.fire("gotopage", this.modaldata.yes || 1);
                } else {
                    this.fire("gotopage", this.modaldata.no || 0);
                }
            },
            closeModal: function(e) {
                this.$.modal.closingReason.confirmed = true;
                this.$.modal.close();
                console.log("close modal confirmed");

            },
            closeModalDismiss: function(e) {
                this.$.modal.closingReason.confirmed = false;
                this.$.modal.close();
                console.log("close modal dismissed");

            },
            handleEvent: function(event) {
                switch (event.type) {
                    case "keydown":
                        this.keylookup(event);
                        break;
                }
            },
            keylookup: function(e) {
                var code = this.keys[e.key] || {
                    handle: function() {
                        return;
                    }
                };
                code.handle.call(this);

            }
        });
    </script>
</dom-module>
