<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="my-modal">
    <style>
        iron-icon.ok {
            color: green !important;
        }

        iron-icon.cross {
            color: red !important;
        }
    </style>
    <template>
        <paper-dialog id="modal" modal on-iron-overlay-closed="handleClose">
            <iron-a11y-keys id="modalconfirm" target='[[target]]' keys="enter" on-keys-pressed="closeModal">
            </iron-a11y-keys>
            <iron-a11y-keys id="modaldismiss" target='[[target]]' keys="[[modal_no.keys]]" on-keys-pressed="closeModalDismiss"></iron-a11y-keys>
            <img src$="[[modaldata.img]]" />
            <p>[[modaldata.text]]</p>
            <div class="buttons">
                <!-- <paper-button noink on-tap="closeModalDismiss">
                    <iron-icon class="cross" icon="icomoon:cross"></iron-icon>[[modaldata.no_text]]</paper-button>
                <paper-button noink on-tap="closeModal">
                    <iron-icon class="ok" icon="icomoon:checkmark"></iron-icon>[[modaldata.yes_text]]</paper-button> -->
                <paper-button noink dialog-dismiss>
                    <iron-icon class="cross" icon="icomoon:cross"></iron-icon>[[modaldata.no_text]]</paper-button>
                <paper-button noink dialog-confirm>
                    <iron-icon class="ok" icon="icomoon:checkmark"></iron-icon>[[modaldata.yes_text]]</paper-button>
            </div>
        </paper-dialog>
    </template>

    <script>
        Polymer({
            is: 'my-modal',
            properties: {
                modaldata: {
                    type: Object,
                    value: {}
                },
                modal_yes: {
                    type: Object,
                    value: {
                        "keys": "enter"
                    }
                },
                modal_no: {
                    type: Object,
                    value: {
                        "keys": "x"
                    }
                }
                // },
                // active: {
                //     type: Boolean,
                //     observer: '_activeChanged'
                // }
            },
            ready: function() {
                this.keys = {
                    enter: {
                        func: "modal_close",
                        handle: this.closeModal
                    },
                    x: {
                        func: "modal_dismiss",
                        handle: this.closeModalDismiss
                    }
                };
            },
            openmodal: function() {
                this.$.modal.open();
                document.body.addEventListener("modal_keydown", this, false);
            },
            closeModal: function(e) {
                this.$.modal.close();
                console.log("close modal confirmed");

            },

            handleClose: function(e) {
                document.body.removeEventListener("modal_keydown", this, false);

                if (e.detail.canceled) {
                    this.fire("gotopage", this.modaldata.no || 0);
                    // if (this.modaldata.no) {
                    //     this.fire("gotopage", this.modaldata.no||0);
                    // } else {
                    //     //this.active = true;
                    //     this.fire("gotopage",0);
                    // }
                } else {
                    this.fire("gotopage", this.modaldata.yes || 1);
                    // if (this.modaldata.yes) {
                    //     this.fire("gotopage", this.modaldata.yes);
                    // } else {
                    //     this._next();
                    // }
                }
            },

            closeModalDismiss: function(e) {
                this.$.modal.cancel();
                console.log("close modal dismissed");
                //document.body.removeEventListener("modal_keydown", this, false);
                // this.$.modalconfirm.target = this.$.modal;
                // this.$.modaldismiss.target = this.$.modal;


                // if (this.modaldata.no) {
                //     this.fire("gotopage", this.modaldata.no);
                // } else {
                //     //this.active = true;
                //     this.set("active", true);
                // }
                //}
            },
            handleEvent: function(event) {
                switch (event.type) {
                    case "modal_keydown":
                        this.keylookup(event);
                        break;
                }
            },
            keylookup: function(e) {
                var code = this.keys[e.key] || {
                    handle: function() {
                        return;
                    }
                };
                code.handle.call(this);

            }
        });
    </script>
</dom-module>
